---
- name: "LeadGen | install psql client (if needed)"
  ansible.builtin.package:
    name: postgresql
    state: present
  become: true

- name: "LeadGen | apply schema to RDS"
  ansible.builtin.command:
    argv:
      - psql
      - "--host={{ leadgen_db_host }}"
      - "--port={{ leadgen_db_port }}"
      - "--username={{ leadgen_db_user }}"
      - "--dbname={{ leadgen_db_name }}"
      - "--set=ON_ERROR_STOP=1"
      - "--file={{ role_path }}/files/schema.sql"
  environment:
    PGPASSWORD: "{{ leadgen_db_password }}"
  changed_when: false
  no_log: true
  become: true
